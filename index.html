<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Signal Alerts â€” Bet Point</title>

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  let rowId = null; // user enters their rowId
  let deviceType = 'web'; // can detect mobile via userAgent
  let playerId = null;

  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "2b94ad70-2518-44d4-aaef-bfb95739206f",
      notifyButton: { enable: false }
    });

    OneSignal.on('subscriptionChange', async function(isSubscribed) {
      if (isSubscribed) {
        playerId = await OneSignal.getUserId();
        if (rowId && playerId) {
          // Register device
          fetch('http://localhost:5000/register-device', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({rowId, playerId, deviceType})
          }).then(res => res.json()).then(console.log);
        }
      }
    });
  });

  function submitRowId() {
    rowId = document.getElementById('rowIdInput').value;
    alert('Row ID set. Allow notifications to register your device.');
  }
</script>

</head>
<body>
<h2>Enter Row ID</h2>
<input type="text" id="rowIdInput" placeholder="Row ID"/>
<button onclick="submitRowId()">Submit</button>

<iframe src="https://bet-point.appsmith.com/app/signal/page1-68b217383a43874978908b5c?embed=true" 
        title="Bet Point Signals App" 
        style="width:100%; height:80vh; border:none;"></iframe>
</body>
</html>


